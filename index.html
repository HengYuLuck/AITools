<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ÂÆùÂÆùÊô∫ËÉΩËµ∑ÂêçÁ•ûÂô® - AIÁßëÂ≠¶Ëµ∑Â•ΩÂêç</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 414px;
            margin: 0 auto;
            background: #fff;
            min-height: 100vh;
            position: relative;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #D32F2F 0%, #FF6B6B 100%);
            color: white;
            text-align: center;
            padding: 40px 20px 30px;
            position: relative;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='4'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
        }
        
        .header-content {
            position: relative;
            z-index: 1;
        }
        
        .title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .subtitle {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 15px;
        }
        
        .stats {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .form-section {
            padding: 30px 20px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
        }
        
        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #D32F2F;
            box-shadow: 0 0 0 3px rgba(211, 47, 47, 0.1);
        }
        
        .gender-group {
            display: flex;
            gap: 12px;
        }
        
        .gender-option {
            flex: 1;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .gender-option.active {
            border-color: #D32F2F;
            background: #D32F2F;
            color: white;
        }
        
        .datetime-group {
            display: flex;
            gap: 12px;
        }
        
        .datetime-input {
            flex: 1;
        }
        
        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #D32F2F 0%, #FF6B6B 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(211, 47, 47, 0.3);
        }
        
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .loading-section {
            text-align: center;
            padding: 60px 20px;
        }
        
        .loading-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 30px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #D32F2F;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 18px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .loading-progress {
            width: 200px;
            height: 6px;
            background: #f0f0f0;
            border-radius: 3px;
            margin: 20px auto;
            overflow: hidden;
        }
        
        .loading-bar {
            height: 100%;
            background: linear-gradient(90deg, #D32F2F, #FF6B6B);
            border-radius: 3px;
            animation: progress 3s ease-in-out;
        }
        
        @keyframes progress {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        
        .result-section {
            padding: 20px;
        }
        
        .bazi-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .bazi-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .bazi-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 14px;
        }
        
        .wuxing-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .wuxing-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        
        .wuxing-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .wuxing-name {
            font-weight: 600;
        }
        
        .wuxing-stars {
            color: #FFD700;
        }
        
        .name-card {
            background: white;
            border: 2px solid #e1e5e9;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .name-card.best {
            border-color: #D32F2F;
            background: linear-gradient(135deg, #fff5f5 0%, #ffeaea 100%);
        }
        
        .name-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .name-text {
            font-size: 24px;
            font-weight: bold;
            color: #D32F2F;
        }
        
        .name-score {
            font-size: 18px;
            font-weight: bold;
            color: #FF6B6B;
        }
        
        .name-stars {
            color: #FFD700;
            font-size: 18px;
            margin: 5px 0;
        }
        
        .name-meaning {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
            margin-bottom: 10px;
        }
        
        .name-wuxing {
            font-size: 13px;
            color: #888;
        }
        
        .share-section {
            padding: 20px;
            text-align: center;
            border-top: 1px solid #eee;
        }
        
        .share-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 10px;
        }
        
        .retry-btn {
            width: 100%;
            padding: 15px;
            background: transparent;
            color: #D32F2F;
            border: 2px solid #D32F2F;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .hidden {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            position: absolute !important;
            left: -9999px !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- È¶ñÈ°µË°®Âçï -->
        <div id="formSection" class="form-page">
            <div class="header">
                <div class="header-content">
                    <h1 class="title">üèÆ ÂÆùÂÆùÊô∫ËÉΩËµ∑ÂêçÁ•ûÂô® üèÆ</h1>
                    <p class="subtitle">‰º†ÊâøÂçÉÂπ¥ÂëΩÁêÜÊô∫ÊÖßÔºåAIÁßëÂ≠¶Ëµ∑Â•ΩÂêç</p>
                    <p class="stats">üí´ Â∑≤‰∏∫ 100‰∏á+ ÂÆùÂÆùËµ∑ÂêçÊàêÂäü</p>
                </div>
            </div>
            
            <div class="form-section">
                <form id="namingForm">
                    <div class="form-group">
                        <label class="form-label">üë∂ ÂÆùÂÆùÂßìÊ∞è</label>
                        <input type="text" class="form-input" id="surname" placeholder="ËØ∑ËæìÂÖ•ÂßìÊ∞èÔºåÂ¶ÇÔºöÂº†" maxlength="2" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">üë¶üëß ÂÆùÂÆùÊÄßÂà´</label>
                        <div class="gender-group">
                            <div class="gender-option" data-gender="male">üë¶ Áî∑ÂÆù</div>
                            <div class="gender-option" data-gender="female">üëß Â•≥ÂÆù</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">üìÖ Âá∫ÁîüÊó•Êúü</label>
                        <div class="datetime-group">
                            <input type="date" class="form-input datetime-input" id="birthDate" required>
                            <input type="time" class="form-input datetime-input" id="birthTime" required>
                        </div>
                    </div>
                    
                    <button type="submit" class="submit-btn">üéØ Á´ãÂç≥ÂÖçË¥πËµ∑Âêç</button>
                </form>
            </div>
        </div>
        
        <!-- ÂàÜÊûêÈ°µÈù¢ -->
        <div id="loadingSection" class="loading-section hidden">
            <div class="loading-icon"></div>
            <div class="loading-text" id="loadingText">üîÆ Ê≠£Âú®‰∏∫ÊÇ®ÁöÑÂÆùÂÆùÂàÜÊûê...</div>
            <div class="loading-progress">
                <div class="loading-bar"></div>
            </div>
        </div>
        
        <!-- ÁªìÊûúÈ°µÈù¢ -->
        <div id="resultSection" class="result-section hidden">
            <div class="bazi-card">
                <div class="bazi-title">üìÖ ÂÆùÂÆùÂëΩÁêÜ‰ø°ÊÅØ</div>
                <div class="bazi-info" id="baziInfo">
                    <!-- ÂÖ´Â≠ó‰ø°ÊÅØÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
            
            <div class="wuxing-card">
                <div class="wuxing-title">üî• ‰∫îË°åÂàÜÊûê</div>
                <div id="wuxingAnalysis">
                    <!-- ‰∫îË°åÂàÜÊûêÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
            
            <div id="nameResults">
                <!-- Êé®ËçêÂêçÂ≠óÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
            </div>
            
            <div class="share-section">
                <button class="share-btn" onclick="shareResult()">üì§ ÂàÜ‰∫´Âà∞ÊúãÂèãÂúà</button>
                <button class="retry-btn" onclick="resetForm()">üîÑ ÂÜçËµ∑‰∏Ä‰∏™ÂêçÂ≠ó</button>
            </div>
        </div>
    </div>

    <!-- ÂºïÂÖ•Â≠óÂ∫ìÊï∞ÊçÆ -->
    <script src="nameDatabase.js"></script>
    <script src="expandDatabase.js"></script>
    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let selectedGender = '';
        let currentResult = null;
        
        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // Á°Æ‰øùÈ°µÈù¢Áä∂ÊÄÅÊ≠£Á°Æ - Âè™ÊòæÁ§∫Ë°®ÂçïÈ°µÈù¢
            showSection('formSection');
            
            initForm();
            
            // ËÆæÁΩÆÈªòËÆ§Êó•Êúü‰∏∫‰ªäÂ§©
            const today = new Date();
            document.getElementById('birthDate').value = today.toISOString().split('T')[0];
            document.getElementById('birthTime').value = '12:00';
        });
        
        // ÂàùÂßãÂåñË°®Âçï
        function initForm() {
            // ÊÄßÂà´ÈÄâÊã©
            document.querySelectorAll('.gender-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.gender-option').forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    selectedGender = this.dataset.gender;
                });
            });
            
            // Ë°®ÂçïÊèê‰∫§
            document.getElementById('namingForm').addEventListener('submit', function(e) {
                e.preventDefault();
                if (validateForm()) {
                    startNaming();
                }
            });
        }
        
        // Ë°®ÂçïÈ™åËØÅ
        function validateForm() {
            const surname = document.getElementById('surname').value.trim();
            const birthDate = document.getElementById('birthDate').value;
            const birthTime = document.getElementById('birthTime').value;
            
            if (!surname) {
                alert('ËØ∑ËæìÂÖ•ÂÆùÂÆùÂßìÊ∞è');
                return false;
            }
            
            if (!selectedGender) {
                alert('ËØ∑ÈÄâÊã©ÂÆùÂÆùÊÄßÂà´');
                return false;
            }
            
            if (!birthDate || !birthTime) {
                alert('ËØ∑ÈÄâÊã©Âá∫ÁîüÊó•ÊúüÂíåÊó∂Èó¥');
                return false;
            }
            
            return true;
        }
        
        // ÂºÄÂßãËµ∑ÂêçÂàÜÊûê
        function startNaming() {
            console.log('ÂºÄÂßãËµ∑ÂêçÂàÜÊûê...');
            try {
                showSection('loadingSection');
                
                const loadingTexts = [
                    'üîÆ Ê≠£Âú®ËÆ°ÁÆóÁîüËæ∞ÂÖ´Â≠ó...',
                    'üåü ÂàÜÊûê‰∫îË°åÁº∫Â§±‰∏≠...',
                    'üí´ ÂåπÈÖçÊúÄ‰Ω≥Áî®Â≠ó‰∏≠...',
                    'üéä ÁîüÊàê‰∏ìÂ±ûÂ•ΩÂêç‰∏≠...'
                ];
                
                let index = 0;
                const interval = setInterval(() => {
                    try {
                        if (index < loadingTexts.length) {
                            const loadingTextElement = document.getElementById('loadingText');
                            if (loadingTextElement) {
                                loadingTextElement.textContent = loadingTexts[index];
                            }
                            index++;
                        } else {
                            clearInterval(interval);
                            setTimeout(() => {
                                generateResult();
                            }, 500);
                        }
                    } catch (error) {
                        console.error('Loading interval error:', error);
                        clearInterval(interval);
                    }
                }, 800);
            } catch (error) {
                console.error('startNaming error:', error);
                alert('Ëµ∑ÂêçËøáÁ®ã‰∏≠Âá∫Áé∞ÈîôËØØÔºåËØ∑ÈáçËØï');
            }
        }
        
        // ÁîüÊàêËµ∑ÂêçÁªìÊûú
        function generateResult() {
            console.log('ÁîüÊàêËµ∑ÂêçÁªìÊûú...');
            try {
                const surname = document.getElementById('surname').value.trim();
                const birthDate = document.getElementById('birthDate').value;
                const birthTime = document.getElementById('birthTime').value;
                const gender = selectedGender;
                
                console.log('Ë°®ÂçïÊï∞ÊçÆ:', { surname, birthDate, birthTime, gender });
                
                // Ê®°ÊãüËÆ°ÁÆóÂÖ´Â≠ó
                const bazi = calculateBazi(birthDate, birthTime);
                
                // Ê®°Êãü‰∫îË°åÂàÜÊûê
                const wuxing = analyzeWuxing(bazi);
                
                // Ê®°ÊãüÁîüÊàêÂêçÂ≠ó
                const names = generateNames(surname, gender, wuxing);
                
                currentResult = {
                    surname,
                    gender,
                    birthDate,
                    birthTime,
                    bazi,
                    wuxing,
                    names
                };
                
                console.log('ÁîüÊàêÁöÑÁªìÊûú:', currentResult);
                displayResult();
            } catch (error) {
                console.error('generateResult error:', error);
                alert('ÁîüÊàêÁªìÊûúÊó∂Âá∫Áé∞ÈîôËØØÔºåËØ∑ÈáçËØï');
            }
        }
        
        // ËÆ°ÁÆóÂÖ´Â≠óÔºàÁúüÂÆûÁÆóÊ≥ïÔºâ
        function calculateBazi(date, time) {
            const heavenly = ['Áî≤', '‰πô', '‰∏ô', '‰∏Å', 'Êàä', 'Â∑±', 'Â∫ö', 'Ëæõ', 'Â£¨', 'Áô∏'];
            const earthly = ['Â≠ê', '‰∏ë', 'ÂØÖ', 'ÂçØ', 'Ëæ∞', 'Â∑≥', 'Âçà', 'Êú™', 'Áî≥', 'ÈÖâ', 'Êàå', '‰∫•'];
            
            const birthDate = new Date(date + 'T' + time);
            const year = birthDate.getFullYear();
            const month = birthDate.getMonth() + 1;
            const day = birthDate.getDate();
            const hour = birthDate.getHours();
            
            // Âπ¥Êü±ËÆ°ÁÆóÔºà‰ª•Á´ãÊò•‰∏∫ÁïåÔºâ
            let lunarYear = year;
            const springStart = getSpringDate(year);
            if (birthDate < springStart) {
                lunarYear = year - 1;
            }
            
            const yearSky = heavenly[(lunarYear - 4) % 10];
            const yearEarth = earthly[(lunarYear - 4) % 12];
            
            // ÊúàÊü±ËÆ°ÁÆóÔºà‰ª•ËäÇÊ∞î‰∏∫ÁïåÔºâ
            const monthIndex = getSolarMonth(birthDate);
            const monthSkyIndex = ((lunarYear - 4) % 10) * 2 + monthIndex;
            const monthSky = heavenly[monthSkyIndex % 10];
            const monthEarth = earthly[(monthIndex + 2) % 12];
            
            // Êó•Êü±ËÆ°ÁÆóÔºàÂÑíÁï•Êó•ÁÆóÊ≥ïÔºâ
            const julianDay = getJulianDay(year, month, day);
            const daySkyIndex = (julianDay - 11) % 10;
            const dayEarthIndex = (julianDay - 11) % 12;
            const daySky = heavenly[daySkyIndex];
            const dayEarth = earthly[dayEarthIndex];
            
            // Êó∂Êü±ËÆ°ÁÆó
            const hourIndex = Math.floor((hour + 1) / 2) % 12;
            const hourSkyIndex = (daySkyIndex * 2 + hourIndex) % 10;
            const hourSky = heavenly[hourSkyIndex];
            const hourEarth = earthly[hourIndex];
            
            return {
                year: yearSky + yearEarth,
                month: monthSky + monthEarth,
                day: daySky + dayEarth,
                hour: hourSky + hourEarth,
                elements: {
                    year: getElementFromStem(yearSky),
                    month: getElementFromStem(monthSky),
                    day: getElementFromStem(daySky),
                    hour: getElementFromStem(hourSky)
                }
            };
        }
        
        // Ëé∑ÂèñÁ´ãÊò•Êó•Êúü
        function getSpringDate(year) {
            // ÁÆÄÂåñËÆ°ÁÆóÔºåÂÆûÈôÖÂ∫îÁî®‰∏≠ÈúÄË¶ÅÊõ¥Á≤æÁ°ÆÁöÑËäÇÊ∞îËÆ°ÁÆó
            return new Date(year, 1, 4); // Â§ßÁ∫¶2Êúà4Êó•
        }
        
        // Ëé∑ÂèñËäÇÊ∞îÊúà‰ªΩ
        function getSolarMonth(date) {
            const month = date.getMonth();
            const day = date.getDate();
            
            // ÁÆÄÂåñÁöÑËäÇÊ∞îËÆ°ÁÆó
            const solarMonths = [11, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
            let solarMonth = solarMonths[month];
            
            // Ê†πÊçÆÂÖ∑‰ΩìÊó•ÊúüË∞ÉÊï¥ÔºàÁÆÄÂåñÁâàÊú¨Ôºâ
            if ((month === 0 && day < 6) || (month === 11 && day >= 6)) {
                solarMonth = month === 0 ? 11 : 0;
            }
            
            return solarMonth;
        }
        
        // ÂÑíÁï•Êó•ËÆ°ÁÆó
        function getJulianDay(year, month, day) {
            if (month <= 2) {
                year -= 1;
                month += 12;
            }
            const a = Math.floor(year / 100);
            const b = 2 - a + Math.floor(a / 4);
            return Math.floor(365.25 * (year + 4716)) + Math.floor(30.6001 * (month + 1)) + day + b - 1524;
        }
        
        // ‰ªéÂ§©Âπ≤Ëé∑Âèñ‰∫îË°å
        function getElementFromStem(stem) {
            const stemElements = {
                'Áî≤': 'Êú®', '‰πô': 'Êú®',
                '‰∏ô': 'ÁÅ´', '‰∏Å': 'ÁÅ´',
                'Êàä': 'Âúü', 'Â∑±': 'Âúü',
                'Â∫ö': 'Èáë', 'Ëæõ': 'Èáë',
                'Â£¨': 'Ê∞¥', 'Áô∏': 'Ê∞¥'
            };
            return stemElements[stem] || 'Êú®';
        }
        
        // ‰∫îË°åÂàÜÊûêÔºàÁúüÂÆûÁÆóÊ≥ïÔºâ
        function analyzeWuxing(bazi) {
            // ÁªüËÆ°ÂÖ´Â≠ó‰∏≠ÁöÑ‰∫îË°å
            const elements = { 'Èáë': 0, 'Êú®': 0, 'Ê∞¥': 0, 'ÁÅ´': 0, 'Âúü': 0 };
            
            // ‰ªéÂ§©Âπ≤ÂàÜÊûê
            Object.values(bazi.elements).forEach(element => {
                elements[element]++;
            });
            
            // ‰ªéÂú∞ÊîØÂàÜÊûêÔºàÁÆÄÂåñÁâàÊú¨Ôºâ
            const branchElements = {
                'Â≠ê': 'Ê∞¥', '‰∫•': 'Ê∞¥',
                'ÂØÖ': 'Êú®', 'ÂçØ': 'Êú®',
                'Â∑≥': 'ÁÅ´', 'Âçà': 'ÁÅ´',
                'Áî≥': 'Èáë', 'ÈÖâ': 'Èáë',
                'Ëæ∞': 'Âúü', 'Êàå': 'Âúü', '‰∏ë': 'Âúü', 'Êú™': 'Âúü'
            };
            
            [bazi.year, bazi.month, bazi.day, bazi.hour].forEach(pillar => {
                const branch = pillar[1];
                const element = branchElements[branch];
                if (element) {
                    elements[element]++;
                }
            });
            
            // ÂàÜÊûê‰∫îË°åÂº∫Âº±
            const total = Object.values(elements).reduce((sum, count) => sum + count, 0);
            const lacking = [];
            const weak = [];
            const strong = [];
            
            Object.entries(elements).forEach(([element, count]) => {
                const percentage = count / total;
                if (count === 0) {
                    lacking.push(element);
                } else if (percentage < 0.15) {
                    weak.push(element);
                } else if (percentage > 0.3) {
                    strong.push(element);
                }
            });
            
            // ÁîüÊàêÂª∫ËÆÆ
            let suggestion = '';
            if (lacking.length > 0) {
                const needElement = lacking[0];
                suggestion = `‰∫îË°åÁº∫${lacking.join('„ÄÅ')}ÔºåÂª∫ËÆÆÈÄâÁî®${needElement}Â≠óÊóÅÁöÑÂ≠óÔºåÂ¶ÇÔºö${getElementSamples(needElement)}`;
            } else if (weak.length > 0) {
                const needElement = weak[0];
                suggestion = `‰∫îË°å${weak.join('„ÄÅ')}ÂÅèÂº±ÔºåÂª∫ËÆÆÂä†Âº∫${needElement}Â≠óÊóÅÁöÑÂ≠óÔºåÂ¶ÇÔºö${getElementSamples(needElement)}`;
            } else {
                suggestion = '‰∫îË°åÁõ∏ÂØπÂπ≥Ë°°ÔºåÂèØÊ†πÊçÆÈü≥ÈüµÁæéÊÑüÈÄâÊã©Áî®Â≠ó';
            }
            
            return { 
                elements, 
                lacking, 
                weak,
                strong,
                suggestion,
                needElement: lacking.length > 0 ? lacking[0] : (weak.length > 0 ? weak[0] : null)
            };
        }
        
        // Ëé∑Âèñ‰∫îË°åÁî®Â≠óÁ§∫‰æã
        function getElementSamples(element) {
            const samples = {
                'Èáë': 'Èë´„ÄÅÈí∞„ÄÅÈì≠„ÄÅÈîê„ÄÅÈí¢',
                'Êú®': 'Êûó„ÄÅÊ£Æ„ÄÅÊ•†„ÄÅÊüè„ÄÅÊ°Ç', 
                'Ê∞¥': 'Êµ∑„ÄÅÊ±ü„ÄÅÊ∂õ„ÄÅÊ∂¶„ÄÅÊ≥Ω',
                'ÁÅ´': 'ÁÇé„ÄÅÁÖú„ÄÅÁÉ®„ÄÅÁÅø„ÄÅÊôñ',
                'Âúü': 'Âù§„ÄÅÂú≥„ÄÅÂüé„ÄÅÂüπ„ÄÅÂ†É'
            };
            return samples[element] || '';
        }
        
        // ÁîüÊàêÂêçÂ≠óÔºàÂ¢ûÂº∫ÁÆóÊ≥ïÔºâ
        function generateNames(surname, gender, wuxing) {
            // Ëé∑ÂèñÂÆåÊï¥ÁöÑÂ≠óÂ∫ì
            const nameDatabase = getNameDatabase();
            const targetElement = wuxing.needElement;
            
            // Ê†πÊçÆÊÄßÂà´Âíå‰∫îË°åÈúÄÊ±ÇÁ≠õÈÄâÂêàÈÄÇÁöÑÂ≠ó
            let candidates = [];
            
            if (targetElement) {
                // ‰ºòÂÖàÈÄâÊã©Ë°•‰∫îË°åÁöÑÂ≠ó
                candidates = nameDatabase.filter(char => 
                    char.element === targetElement && 
                    char.gender.includes(gender)
                );
            }
            
            // Â¶ÇÊûúÂÄôÈÄâÂ≠ó‰∏çÂ§üÔºåÂä†ÂÖ•ÈÄöÁî®Â•ΩÂ≠ó
            if (candidates.length < 10) {
                const generalChars = nameDatabase.filter(char => 
                    char.gender.includes(gender) || char.gender.includes('both')
                );
                candidates = [...candidates, ...generalChars];
            }
            
            // ÈöèÊú∫Êâì‰π±ÂÄôÈÄâÂ≠óÈ°∫Â∫è
            candidates = shuffleArray([...candidates]);
            
            // ÁîüÊàêÂêçÂ≠óÁªÑÂêà
            const nameList = [];
            const maxAttempts = Math.min(candidates.length * candidates.length, 200); // ÈôêÂà∂Â∞ùËØïÊ¨°Êï∞
            
            for (let attempt = 0; attempt < maxAttempts && nameList.length < 20; attempt++) {
                // ÈöèÊú∫ÈÄâÊã©‰∏§‰∏™‰∏çÂêåÁöÑÂ≠ó
                const index1 = Math.floor(Math.random() * candidates.length);
                let index2 = Math.floor(Math.random() * candidates.length);
                
                // Á°Æ‰øù‰∏çÊòØÂêå‰∏Ä‰∏™Â≠ó
                if (index1 === index2) {
                    index2 = (index1 + 1) % candidates.length;
                }
                
                const char1 = candidates[index1];
                const char2 = candidates[index2];
                
                // ÈÅøÂÖçÈáçÂ§çÁöÑÂ≠óÁ¨¶
                if (char1.char === char2.char) continue;
                
                const name = char1.char + char2.char;
                const fullName = surname + name;
                
                // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÁîüÊàêËøáËøô‰∏™ÂêçÂ≠ó
                if (nameList.some(existing => existing.name === name)) continue;
                
                // ËÆ°ÁÆóÂêçÂ≠óËØÑÂàÜ
                const score = calculateNameScore(surname, name, wuxing);
                
                // ÁîüÊàêÂØìÊÑèËß£Èáä
                const meaning = `${char1.char}Ôºà${char1.meaning}Ôºâ${char2.char}Ôºà${char2.meaning}Ôºâ`;
                
                // ÂàÜÊûê‰∫îË°åÊê≠ÈÖç
                const nameWuxing = char1.element + char2.element;
                
                nameList.push({
                    name,
                    fullName,
                    meaning,
                    score,
                    wuxing: nameWuxing,
                    isTop: false,
                    strokes: char1.strokes + char2.strokes,
                    phonetics: analyzePhonetics(fullName)
                });
            }
            
            // ÊåâËØÑÂàÜÊéíÂ∫è
            nameList.sort((a, b) => b.score - a.score);
            
            // Ê†áËÆ∞ÊúÄ‰Ω≥ÂêçÂ≠ó
            nameList.forEach((name, index) => {
                name.isTop = index === 0;
            });
            
            return nameList.slice(0, 5);
        }
        
        // Êï∞ÁªÑÈöèÊú∫Êâì‰π±ÂáΩÊï∞
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
        
        // Ëé∑ÂèñÂ≠óÂ∫ìÊï∞ÊçÆ
        function getNameDatabase() {
            // ‰ΩøÁî®Â§ñÈÉ®Â≠óÂ∫ìÊñá‰ª∂‰∏≠ÁöÑÊï∞ÊçÆ
            return typeof NAME_DATABASE !== 'undefined' ? NAME_DATABASE : [];
        }
        
        // ÊòæÁ§∫ÁªìÊûú
        function displayResult() {
            console.log('ÂºÄÂßãÊòæÁ§∫ÁªìÊûú...');
            try {
                // ÊòæÁ§∫ÂÖ´Â≠ó‰ø°ÊÅØ
                const baziInfo = document.getElementById('baziInfo');
            baziInfo.innerHTML = `
                <div>Âá∫ÁîüÊó•ÊúüÔºö${currentResult.birthDate}</div>
                <div>Âá∫ÁîüÊó∂Èó¥Ôºö${currentResult.birthTime}</div>
                <div>Âπ¥Êü±Ôºö${currentResult.bazi.year}</div>
                <div>ÊúàÊü±Ôºö${currentResult.bazi.month}</div>
                <div>Êó•Êü±Ôºö${currentResult.bazi.day}</div>
                <div>Êó∂Êü±Ôºö${currentResult.bazi.hour}</div>
            `;
            
            // ÊòæÁ§∫‰∫îË°åÂàÜÊûê
            const wuxingAnalysis = document.getElementById('wuxingAnalysis');
            let wuxingHtml = '';
            Object.entries(currentResult.wuxing.elements).forEach(([element, count]) => {
                const stars = '‚òÖ'.repeat(count) + '‚òÜ'.repeat(4 - count);
                wuxingHtml += `
                    <div class="wuxing-item">
                        <span class="wuxing-name">${element}Ôºö</span>
                        <span class="wuxing-stars">${stars}</span>
                    </div>
                `;
            });
            wuxingHtml += `<p style="margin-top: 15px; color: #666; font-size: 14px;">${currentResult.wuxing.suggestion}</p>`;
            wuxingAnalysis.innerHTML = wuxingHtml;
            
            // ÊòæÁ§∫Êé®ËçêÂêçÂ≠ó
            const nameResults = document.getElementById('nameResults');
            let namesHtml = '';
            currentResult.names.forEach((name, index) => {
                const stars = '‚≠ê'.repeat(Math.floor(name.score / 20));
                const complementInfo = currentResult.wuxing.needElement ? `ÔºåË°•${currentResult.wuxing.needElement}Âº∫Ëøê` : '';
                
                namesHtml += `
                    <div class="name-card ${name.isTop ? 'best' : ''}">
                        <div class="name-header">
                            <div class="name-text">„Äê${name.fullName}„Äë</div>
                            <div class="name-score">${name.score}ÂàÜ</div>
                        </div>
                        <div class="name-stars">${stars}</div>
                        <div class="name-meaning">üìñ ${name.meaning}</div>
                        <div class="name-wuxing">üî• ‰∫îË°åÔºö${name.wuxing}${complementInfo}</div>
                        <div class="name-wuxing">‚úçÔ∏è Á¨îÁîªÔºö${name.strokes}Áîª</div>
                        <div class="name-wuxing">üéµ Èü≥ÈüµÔºö${name.phonetics.analysis}</div>
                    </div>
                `;
            });
            nameResults.innerHTML = namesHtml;
            
            showSection('resultSection');
            console.log('ÁªìÊûúÊòæÁ§∫ÂÆåÊàê');
            } catch (error) {
                console.error('displayResult error:', error);
                alert('ÊòæÁ§∫ÁªìÊûúÊó∂Âá∫Áé∞ÈîôËØØÔºåËØ∑ÈáçËØï');
            }
        }
        
        // ÂàáÊç¢ÊòæÁ§∫ÁöÑÈ°µÈù¢
        function showSection(sectionId) {
            console.log('ÂàáÊç¢Âà∞È°µÈù¢:', sectionId);
            try {
                const sections = ['formSection', 'loadingSection', 'resultSection'];
                
                // ÈöêËóèÊâÄÊúâÈ°µÈù¢
                sections.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.classList.add('hidden');
                        element.style.display = 'none';
                        element.style.visibility = 'hidden';
                        element.style.opacity = '0';
                    }
                });
                
                // ÊòæÁ§∫ÁõÆÊ†áÈ°µÈù¢
                const targetSection = document.getElementById(sectionId);
                if (targetSection) {
                    targetSection.classList.remove('hidden');
                    targetSection.style.display = 'block';
                    targetSection.style.visibility = 'visible';
                    targetSection.style.opacity = '1';
                    targetSection.style.position = 'relative';
                    targetSection.style.left = 'auto';
                    console.log('ÊàêÂäüÊòæÁ§∫È°µÈù¢:', sectionId);
                } else {
                    console.error('Êâæ‰∏çÂà∞ÁõÆÊ†áÈ°µÈù¢:', sectionId);
                }
            } catch (error) {
                console.error('showSection error:', error);
            }
        }
        
        // ÂàÜ‰∫´ÁªìÊûú
        function shareResult() {
            if (!currentResult) return;
            
            const shareText = `ÊàëÁªôÂÆùÂÆùÁî®AIËµ∑‰∫Ü‰∏™Â•ΩÂêçÂ≠óÔºö${currentResult.names[0].fullName}ÔºåÁªºÂêàËØÑÂàÜ${currentResult.names[0].score}ÂàÜÔºÅ\n\n‰º†ÊâøÂçÉÂπ¥ÂëΩÁêÜÊô∫ÊÖßÔºåAIÁßëÂ≠¶Ëµ∑Â•ΩÂêç\nüë∂ ‰Ω†‰πüÊÉ≥ÁªôÂÆùÂÆùËµ∑‰∏™Â•ΩÂêçÂ≠óÂêóÔºü`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'ÂÆùÂÆùÊô∫ËÉΩËµ∑ÂêçÁ•ûÂô®',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                // Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø
                navigator.clipboard.writeText(shareText + '\n\n' + window.location.href).then(() => {
                    alert('ÂàÜ‰∫´ÂÜÖÂÆπÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºåÂø´ÂéªÊúãÂèãÂúàÂàÜ‰∫´ÂêßÔºÅ');
                });
            }
        }
        
        // ÈáçÁΩÆË°®Âçï
        function resetForm() {
            document.getElementById('namingForm').reset();
            document.querySelectorAll('.gender-option').forEach(opt => opt.classList.remove('active'));
            selectedGender = '';
            currentResult = null;
            
            // ÈáçÊñ∞ËÆæÁΩÆÈªòËÆ§Êó•Êúü
            const today = new Date();
            document.getElementById('birthDate').value = today.toISOString().split('T')[0];
            document.getElementById('birthTime').value = '12:00';
            
            showSection('formSection');
        }
        
        // ËÆ°ÁÆóÂêçÂ≠óËØÑÂàÜ
        function calculateNameScore(surname, name, wuxing) {
            let score = 0;
            
            // 1. ‰∫îË°åÂåπÈÖçÂ∫¶ (40ÂàÜ)
            if (wuxing.needElement) {
                const nameDatabase = getNameDatabase();
                const nameChars = name.split('');
                let matchCount = 0;
                
                nameChars.forEach(char => {
                    const charData = nameDatabase.find(c => c.char === char);
                    if (charData && charData.element === wuxing.needElement) {
                        matchCount++;
                    }
                });
                
                score += (matchCount / nameChars.length) * 40;
            } else {
                score += 35; // ‰∫îË°åÂπ≥Ë°°Êó∂ÁªôÂü∫Á°ÄÂàÜ
            }
            
            // 2. Á¨îÁîªÊï∞ÁêÜ (25ÂàÜ)
            const strokeScore = calculateStrokeScore(surname, name);
            score += strokeScore;
            
            // 3. Èü≥ÈüµÁæéÊÑü (20ÂàÜ)
            const phoneticScore = calculatePhoneticScore(surname + name);
            score += phoneticScore;
            
            // 4. ÂØìÊÑèÂêâÁ•• (15ÂàÜ)
            const meaningScore = calculateMeaningScore(name);
            score += meaningScore;
            
            return Math.round(score);
        }
        
        // ËÆ°ÁÆóÁ¨îÁîªÊï∞ÁêÜËØÑÂàÜ
        function calculateStrokeScore(surname, name) {
            const nameDatabase = getNameDatabase();
            const surnameStrokes = getCharStrokes(surname);
            
            let totalStrokes = surnameStrokes;
            name.split('').forEach(char => {
                const charData = nameDatabase.find(c => c.char === char);
                totalStrokes += charData ? charData.strokes : 10;
            });
            
            // Ê†πÊçÆÊÄªÁ¨îÁîªÊï∞Âà§Êñ≠ÂêâÂá∂ÔºàÁÆÄÂåñÁâàÊú¨Ôºâ
            const luckyNumbers = [1, 3, 5, 6, 7, 8, 11, 13, 15, 16, 17, 18, 21, 23, 24, 25, 29, 31, 32, 33, 35, 37, 39, 41, 45, 47, 48, 52, 57, 61, 63, 65, 67, 68, 81];
            
            if (luckyNumbers.includes(totalStrokes % 81)) {
                return 25;
            } else if (totalStrokes % 81 < 40) {
                return 15;
            } else {
                return 10;
            }
        }
        
        // Ëé∑ÂèñÂçïÂ≠óÁ¨îÁîªÊï∞
        function getCharStrokes(char) {
            const commonStrokes = {
                'Áéã': 4, 'Êùé': 7, 'Âº†': 11, 'Âàò': 15, 'Èôà': 16, 'Êù®': 13, 'Ëµµ': 14, 'ÈªÑ': 12, 'Âë®': 8, 'Âê¥': 7,
                'Âæê': 10, 'Â≠ô': 6, 'ËÉ°': 9, 'Êú±': 6, 'È´ò': 10, 'Êûó': 8, '‰Ωï': 7, 'ÈÉ≠': 15, 'È©¨': 10, 'ÁΩó': 19,
                'Ê¢Å': 11, 'ÂÆã': 7, 'ÈÉë': 19, 'Ë∞¢': 17, 'Èü©': 17, 'Âîê': 10, 'ÂÜØ': 12, '‰∫é': 3, 'Ëë£': 15, 'Ëêß': 18
            };
            return commonStrokes[char] || 8; // ÈªòËÆ§8Áîª
        }
        
        // ËÆ°ÁÆóÈü≥ÈüµËØÑÂàÜ
        function calculatePhoneticScore(fullName) {
            const tones = getTonesPattern(fullName);
            
            // Ê£ÄÊü•Â£∞Ë∞ÉÊê≠ÈÖçÊòØÂê¶ÂíåË∞ê
            if (tones.length >= 3) {
                // ÈÅøÂÖç‰∏â‰∏™Â≠óÈÉΩÊòØÂêå‰∏ÄÂ£∞Ë∞É
                if (tones[0] === tones[1] && tones[1] === tones[2]) {
                    return 10;
                }
                // Âπ≥‰ªÑÁõ∏Èó¥ÊØîËæÉÂ•ΩÂê¨
                if ((tones[0] !== tones[1]) && (tones[1] !== tones[2])) {
                    return 20;
                }
                return 15;
            }
            return 12;
        }
        
        // Ëé∑ÂèñÂ≠óÁöÑÂ£∞Ë∞ÉÔºàÁÆÄÂåñÁâàÊú¨Ôºâ
        function getTonesPattern(name) {
            const toneMap = {
                // ‰∏ÄÂ£∞ÔºàÈò¥Âπ≥Ôºâ
                'Âº†': 1, 'Áéã': 2, 'Êùé': 3, 'Âàò': 2, 'Èôà': 2, 'Êù®': 2, 'Âë®': 1, 'Âê¥': 2,
                'Èë´': 1, 'Èí∞': 4, 'Êûó': 2, 'Êµ∑': 3, 'ÁÇé': 2, 'Âù§': 1,
                'ËΩ©': 1, 'Áùø': 4, 'Ê∂µ': 2, 'ËØó': 1, 'Èõ®': 3, 'ÊÇ¶': 4
            };
            
            return name.split('').map(char => toneMap[char] || 2);
        }
        
        // ËÆ°ÁÆóÂØìÊÑèËØÑÂàÜ
        function calculateMeaningScore(name) {
            const positiveChars = ['Èë´', 'Èí∞', 'Êûó', 'Êµ∑', 'ÁÇé', 'Âù§', 'ËΩ©', 'Áùø', 'Ê∂µ', 'ËØó', 'Èõ®', 'ÊÇ¶', 'ÈõÖ', 'Áê™', 'Áë∂', 'ÊÖß', 'ÂÆá', 'Ëæ∞', 'Êô®'];
            let score = 0;
            
            name.split('').forEach(char => {
                if (positiveChars.includes(char)) {
                    score += 7.5;
                } else {
                    score += 5;
                }
            });
            
            return Math.min(score, 15);
        }
        
        // Èü≥ÈüµÂàÜÊûê
        function analyzePhonetics(fullName) {
            const tones = getTonesPattern(fullName);
            const toneNames = ['', 'Âπ≥Â£∞', '‰∏äÂ£∞', 'ÂéªÂ£∞', 'ÂÖ•Â£∞'];
            
            let pattern = tones.map(tone => toneNames[tone] || 'Âπ≥Â£∞').join('-');
            
            // Âà§Êñ≠Èü≥ÈüµÁâπÁÇπ
            let analysis = '';
            if (tones.every(tone => tone === tones[0])) {
                analysis = 'Â£∞Ë∞ÉÁªü‰∏ÄÔºåÈü≥ÈüµÂπ≥Á®≥';
            } else if (tones[0] !== tones[1] && tones[1] !== tones[2]) {
                analysis = 'Âπ≥‰ªÑÁõ∏Èó¥ÔºåÊúóÊúó‰∏äÂè£';
            } else {
                analysis = 'Èü≥Ë∞ÉÂíåË∞êÔºåÊÇ¶ËÄ≥Âä®Âê¨';
            }
            
            return { pattern, analysis };
        }
    </script>
</body>
</html> 